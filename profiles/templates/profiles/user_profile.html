{% extends "base.html" %}
{% load static %}

{% block title %}{{ profile.get_display_name }}'s Profile - Downhill Skateboarding Events{% endblock %}

{% block meta_description %}
View {{ profile.get_display_name }}'s skateboarding profile. 
{% if profile.bio %}{{ profile.bio|truncatewords:20 }}{% endif %}
{% if profile.get_location_display %} From {{ profile.get_location_display }}.{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .profile-banner {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
    }
    
    .profile-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('{% static "images/skateboard-pattern.svg" %}') repeat;
        opacity: 0.1;
        z-index: 1;
    }
    
    .profile-avatar {
        position: relative;
        z-index: 10;
        border: 4px solid white;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .skating-style-badge {
        background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .skating-style-badge:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
    }
    
    .achievement-item {
        transition: all 0.3s ease;
    }
    
    .achievement-item:hover {
        transform: translateX(4px);
    }
    
    .stat {
        transition: all 0.3s ease;
    }
    
    .stat:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    .verification-badge {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
    
    .profile-section {
        transition: all 0.3s ease;
    }
    
    .profile-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .social-link {
        transition: transform 0.2s ease;
    }
    
    .social-link:hover {
        transform: scale(1.1);
    }
    
    .event-card {
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .event-card:hover {
        border-color: hsl(var(--p));
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }
    
    .completion-progress {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    
    .tab-content {
        min-height: 400px;
    }
    
    .profile-edit-overlay {
        backdrop-filter: blur(5px);
        background: rgba(0, 0, 0, 0.5);
    }
    
    .input-success {
        border-color: hsl(var(--su)) !important;
        box-shadow: 0 0 0 2px rgba(36, 185, 120, 0.2) !important;
        background-color: rgba(36, 185, 120, 0.05) !important;
    }
    
    .toast {
        z-index: 9999;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-base-100">
    <!-- Profile Header Section -->
    <section class="profile-banner relative h-80 sm:h-80 md:h-80 flex items-center pb-2 sm:pb-4 md:pb-8">
        <div class="container mx-auto px-2 sm:px-4 relative z-10">
            <div class="flex flex-col md:flex-row items-center md:items-end gap-2 sm:gap-4 md:gap-6">
                <!-- Avatar -->
                <div class="relative">
                    {% if profile.avatar %}
                        <img src="{{ profile.avatar.url }}" 
                             alt="{{ profile.get_display_name }}'s avatar" 
                             class="profile-avatar w-20 h-20 sm:w-28 sm:h-28 md:w-40 md:h-40 rounded-full object-cover">
                    {% else %}
                        <div class="profile-avatar w-20 h-20 sm:w-28 sm:h-28 md:w-40 md:h-40 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                            <i class="fas fa-user text-xl sm:text-3xl md:text-5xl text-white"></i>
                        </div>
                    {% endif %}
                    
                    <!-- Verification Badge -->
                    {% if profile.verification_status != 'UNVERIFIED' %}
                        <div class="verification-badge absolute -top-1 -right-1 w-6 h-6 sm:w-8 sm:h-8 bg-success rounded-full flex items-center justify-center border-2 border-white">
                            <i class="fas fa-check text-white text-xs sm:text-sm"></i>
                        </div>
                    {% endif %}
                    
                    <!-- Edit Avatar Button (if owner) -->
                    {% if can_edit %}
                        <button class="absolute bottom-0 right-0 btn btn-xs sm:btn-sm btn-circle btn-primary border-2 border-white" 
                                onclick="document.getElementById('avatar-modal').showModal()">
                            <i class="fas fa-camera text-xs sm:text-sm"></i>
                        </button>
                    {% endif %}
                </div>
                
                <!-- Profile Info -->
                <div class="text-center md:text-left text-white flex-1">
                    <h1 class="text-xl sm:text-2xl  font-bold mb-1 sm:mb-2">
                        <span data-profile-display="display_name">{{ profile.get_display_name }}</span>
                        {% if profile.skating_style %}
                            <span class="text-sm sm:text-lg font-normal opacity-90">🛹</span>
                        {% endif %}
                    </h1>
                    <h2 class="text-sm sm:text-lg font-normal opacity-90">
                        {% if profile.show_real_name and profile.get_full_name != profile.get_display_name %}
                            <span data-profile-display="username" class="hidden">{{ profile.user.username }}</span>
                            ({{ profile.get_full_name }})
                        {% endif %}
                    </h2>
                    <!-- Location -->
                    {% if profile.get_location_display %}
                        <p class="text-sm sm:text-lg opacity-90 mb-1 sm:mb-2">
                            <i class="fas fa-map-marker-alt mr-1 sm:mr-2"></i>
                            <span data-profile-display="location">{{ profile.get_location_display }}</span>
                        </p>
                    {% else %}
                        <p class="text-sm sm:text-lg opacity-90 mb-1 sm:mb-2 {% if not can_edit %}hidden{% endif %}">
                            <i class="fas fa-map-marker-alt mr-1 sm:mr-2"></i>
                            <span data-profile-display="location" class="text-base-content/60">Location not specified</span>
                        </p>
                    {% endif %}
                    
                    <!-- Skateboarding Identity -->
                    <div class="flex flex-wrap gap-1 sm:gap-2 justify-center md:justify-start mb-2 sm:mb-4">
                        {% if profile.skating_style %}
                            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm font-semibold">
                                <span data-profile-display="skating_style">{{ profile.get_skating_style_display }}</span> Skater
                            </span>
                        {% endif %}
                        {% if profile.stance %}
                            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                                <span data-profile-display="stance">{{ profile.get_stance_display }}</span> Stance
                            </span>
                        {% endif %}
                        {% if profile.years_skating %}
                            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                                <span data-profile-display="years_skating">{{ profile.years_skating }}yr{{ profile.years_skating|pluralize }}</span> exp
                            </span>
                        {% endif %}
                        {% if profile.skill_level %}
                            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                                Level <span data-profile-display="skill_level">{{ profile.skill_level }}/10</span>
                            </span>
                        {% endif %}
                    </div>
                    
                    <!-- Bio -->
                    {% if profile.bio %}
                        <p class="text-sm sm:text-base opacity-90 max-w-2xl leading-relaxed hidden sm:block" data-profile-display="bio">{{ profile.bio }}</p>
                        <p class="text-xs opacity-90 leading-relaxed sm:hidden" data-profile-display="bio">{{ profile.bio|truncatewords:15 }}</p>
                    {% else %}
                        <p class="text-xs sm:text-base opacity-70 italic" data-profile-display="bio">
                            {% if can_edit %}
                                Add a bio 🎯
                            {% else %}
                                No bio provided
                            {% endif %}
                        </p>
                    {% endif %}
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-1 sm:gap-2">
                    {% if can_edit %}
                        <button class="btn btn-xs sm:btn-sm btn-primary" onclick="scrollToSettings()">
                            <i class="fas fa-edit mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            <span class="hidden sm:inline">Edit Profile</span>
                            <span class="sm:hidden">Edit</span>
                        </button>
                    {% else %}
                        <!-- Follow/Unfollow Button -->
                        {% include 'profiles/partials/follow_button.html' %}
                        
                        <button class="btn btn-xs sm:btn-sm btn-outline btn-secondary">
                            <i class="fas fa-envelope mr-1 sm:mr-2 text-xs sm:text-sm"></i>
                            <span class="hidden sm:inline">Message</span>
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
    
    <!-- Profile Stats -->
    <section class="container mx-auto px-2 sm:px-4 -mt-4 relative z-20">
        <!-- Profile Stats - Skateboard Focus -->
        <div class="grid grid-cols-2 lg:grid-cols-6 gap-2 sm:gap-3 lg:gap-4 mb-4 sm:mb-6 lg:mb-8">
            <!-- Social Stats -->
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-secondary">
                    <i class="fas fa-users text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Followers</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl follower-count">{{ follower_count }}</div>
                <div class="stat-desc text-xs">
                    <a href="{% url 'profiles:followers_list' profile.user.id %}" class="link link-primary">View all</a>
                </div>
            </div>
            
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-accent">
                    <i class="fas fa-user-friends text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Following</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl following-count">{{ following_count }}</div>
                <div class="stat-desc text-xs">
                    <a href="{% url 'profiles:following_list' profile.user.id %}" class="link link-primary">View all</a>
                </div>
            </div>
            
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-primary">
                    <i class="fas fa-crown text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Events Organized</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl">{{ skating_stats.events_organized }}</div>
                {% if skating_stats.events_organized > 0 %}
                <div class="stat-desc text-xs hidden sm:block">Building community</div>
                {% endif %}
            </div>
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-secondary">
                    <i class="fas fa-skating text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Events Attended</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl">{{ skating_stats.events_attended }}</div>
                <div class="stat-desc text-xs hidden sm:block">Sessions completed</div>
            </div>
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-accent">
                    <i class="fas fa-comment-dots text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Reviews Given</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl">{{ skating_stats.reviews_given }}</div>
                <div class="stat-desc text-xs hidden sm:block">Helping others</div>
            </div>
            <div class="stat bg-base-200 rounded-lg p-2 sm:p-3 lg:p-4">
                <div class="stat-figure text-warning">
                    <i class="fas fa-star text-sm sm:text-lg lg:text-xl"></i>
                </div>
                <div class="stat-title text-xs">Avg Rating</div>
                <div class="stat-value text-sm sm:text-lg lg:text-xl">
                    {% if skating_stats.avg_rating %}
                        {{ skating_stats.avg_rating|floatformat:1 }}★
                    {% else %}
                        -
                    {% endif %}
                </div>
                {% if skating_stats.avg_rating %}
                <div class="stat-desc text-xs hidden sm:block">Community trust</div>
                {% endif %}
            </div>
        </div>
    </section>
    
    <!-- Profile Content -->
    <section class="container mx-auto px-2 sm:px-4 pb-4 sm:pb-8 lg:pb-12">
        <div class="bg-base-100 rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl overflow-hidden">
            <!-- Content -->
            <div class="p-3 sm:p-4 lg:p-6 space-y-4 sm:space-y-6 lg:space-y-8">
                <!-- Overview Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
                    <!-- Left Column - Profile Details -->
                    <div class="lg:col-span-2 space-y-4 sm:space-y-6">
                        <!-- Skateboarding Setup -->
                        {% if profile.primary_setup or profile.stance or profile.skill_level %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body p-3 sm:p-4 lg:p-6">
                                    <h2 class="card-title text-primary text-sm sm:text-base">
                                        <i class="fas fa-skating mr-1 sm:mr-2"></i>
                                        Skateboarding Profile
                                    </h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-1 ">
                                        {% if profile.stance %}
                                            <div class="stat p-1 sm:p-1">
                                                <div class="stat-title text-xs">Stance</div>
                                                <div class="stat-value text-sm sm:text-lg">{{ profile.get_stance_display }}</div>
                                            </div>
                                        {% endif %}
                                        {% if profile.skill_level %}
                                            <div class="stat p-1 sm:p-1">
                                                <div class="stat-title text-xs">Skill Level</div>
                                                <div class="stat-value text-sm sm:text-lg">{{ profile.skill_level }}/10</div>
                                            </div>
                                        {% endif %}
                                        {% if profile.years_skating %}
                                            <div class="stat p-1 sm:p-1">
                                                <div class="stat-title text-xs">Years Skating</div>
                                                <div class="stat-value text-sm sm:text-lg">{{ profile.years_skating }}</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                    {% if profile.primary_setup %}
                                        <div class="mt-2 sm:mt-4">
                                            <h3 class="font-semibold mb-1 sm:mb-2 text-sm sm:text-base">Primary Setup</h3>
                                            <p class="text-base-content/80 text-xs sm:text-sm" data-profile-display="primary_setup">{{ profile.primary_setup }}</p>
                                        </div>
                                    {% else %}
                                        {% if can_edit %}
                                            <div class="mt-2 sm:mt-4">
                                                <h3 class="font-semibold mb-1 sm:mb-2 text-sm sm:text-base">Primary Setup</h3>
                                                <p class="text-base-content/60 text-xs sm:text-sm italic" data-profile-display="primary_setup">No setup information</p>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Skateboarding Bio & Style -->
                        {% if profile.bio or profile.skating_styles.all %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body p-3 sm:p-4 lg:p-6">
                                    <h2 class="card-title text-primary text-sm sm:text-base">
                                        <i class="fas fa-user-circle mr-1 sm:mr-2"></i>
                                        About {{ profile.user.first_name|default:profile.user.username }}
                                    </h2>
                                    
                                    {% if profile.bio %}
                                        <div class="mb-2 sm:mb-4">
                                            <p class="text-base-content leading-relaxed text-xs sm:text-sm">{{ profile.bio }}</p>
                                        </div>
                                    {% endif %}
                                    
                                    {% if profile.skating_styles.all %}
                                        <div class="mt-2 sm:mt-4">
                                            <h3 class="font-semibold mb-2 sm:mb-3 text-sm sm:text-base">Skating Styles</h3>
                                            <div class="flex flex-wrap gap-1 sm:gap-2">
                                                {% for style in profile.skating_styles.all %}
                                                    <span class="skating-style-badge badge badge-sm sm:badge-lg px-2 py-1 sm:px-3 sm:py-2 text-xs sm:text-sm">
                                                        {{ style.name }}
                                                    </span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Current Achievements & Milestones -->
                        {% if skating_stats.events_organized > 0 or skating_stats.events_attended > 5 or skating_stats.avg_rating >= 4.0 %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body p-3 sm:p-4 lg:p-6">
                                    <h2 class="card-title text-accent text-sm sm:text-base">
                                        <i class="fas fa-trophy mr-1 sm:mr-2"></i>
                                        Achievements
                                        <span class="badge badge-accent badge-xs sm:badge-sm">
                                            {% if skating_stats.events_organized > 0 %}1{% endif %}
                                            {% if skating_stats.events_attended >= 5 %}{% if skating_stats.events_organized > 0 %}+{% endif %}1{% endif %}
                                            {% if skating_stats.avg_rating >= 4.0 %}{% if skating_stats.events_organized > 0 or skating_stats.events_attended >= 5 %}+{% endif %}1{% endif %}
                                        </span>
                                    </h2>
                                    <div class="space-y-2 sm:space-y-3">
                                        {% if skating_stats.events_organized > 0 %}
                                            <div class="achievement-item flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-lg bg-primary/10 border border-primary/20">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-primary rounded-full flex items-center justify-center">
                                                    <i class="fas fa-crown text-white text-xs sm:text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <h3 class="font-semibold text-primary text-xs sm:text-sm">Community Organizer</h3>
                                                    <p class="text-xs sm:text-sm text-base-content/70">Organized {{ skating_stats.events_organized }} event{{ skating_stats.events_organized|pluralize }}</p>
                                                </div>
                                                <div class="badge badge-primary badge-xs sm:badge-sm">🏆</div>
                                            </div>
                                        {% endif %}
                                        
                                        {% if skating_stats.events_attended >= 5 %}
                                            <div class="achievement-item flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-lg bg-secondary/10 border border-secondary/20">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-secondary rounded-full flex items-center justify-center">
                                                    <i class="fas fa-skating text-white text-xs sm:text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <h3 class="font-semibold text-secondary text-xs sm:text-sm">Active Skater</h3>
                                                    <p class="text-xs sm:text-sm text-base-content/70">Attended {{ skating_stats.events_attended }} sessions</p>
                                                </div>
                                                <div class="badge badge-secondary badge-xs sm:badge-sm">🛹</div>
                                            </div>
                                        {% endif %}
                                        
                                        {% if skating_stats.avg_rating >= 4.0 %}
                                            <div class="achievement-item flex items-center gap-2 sm:gap-3 p-2 sm:p-3 rounded-lg bg-warning/10 border border-warning/20">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-warning rounded-full flex items-center justify-center">
                                                    <i class="fas fa-star text-white text-xs sm:text-sm"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <h3 class="font-semibold text-warning text-xs sm:text-sm">Trusted Member</h3>
                                                    <p class="text-xs sm:text-sm text-base-content/70">{{ skating_stats.avg_rating|floatformat:1 }}★ average rating</p>
                                                </div>
                                                <div class="badge badge-warning badge-xs sm:badge-sm">⭐</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Right Column - Sidebar -->
                    <div class="space-y-4 sm:space-y-6">
                        <!-- Recent Activity -->
                        {% if recent_activities %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body p-3 sm:p-4 lg:p-6">
                                    <h2 class="card-title text-secondary text-sm sm:text-base">
                                        <i class="fas fa-clock mr-1 sm:mr-2"></i>
                                        Recent Activity
                                    </h2>
                                    <div class="space-y-2 sm:space-y-3">
                                        {% for activity in recent_activities %}
                                            <div class="flex items-start gap-2 sm:gap-3 p-2 rounded-lg bg-base-200/50">
                                                <div class="flex-shrink-0 mt-1">
                                                    {% if activity.activity_type == 'PROFILE_UPDATE' %}
                                                        <i class="fas fa-user text-info text-xs"></i>
                                                    {% elif activity.activity_type == 'EVENT_CREATED' %}
                                                        <i class="fas fa-calendar-plus text-success text-xs"></i>
                                                    {% elif activity.activity_type == 'EVENT_JOINED' %}
                                                        <i class="fas fa-calendar-check text-warning text-xs"></i>
                                                    {% elif activity.activity_type == 'CREW_JOINED' %}
                                                        <i class="fas fa-users text-primary text-xs"></i>
                                                    {% elif activity.activity_type == 'ACHIEVEMENT_EARNED' %}
                                                        <i class="fas fa-trophy text-accent text-xs"></i>
                                                    {% else %}
                                                        <i class="fas fa-bell text-base-content/50 text-xs"></i>
                                                    {% endif %}
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-xs text-base-content/80 leading-relaxed">
                                                        {{ activity.description|truncatewords:10 }}
                                                    </p>
                                                    <p class="text-xs text-base-content/50 mt-1">
                                                        {{ activity.created_at|timesince }} ago
                                                    </p>
                                                </div>
                                            </div>
                                        {% endfor %}
                                        {% if user.is_authenticated %}
                                            <div class="text-center pt-2">
                                                <a href="{% url 'profiles:activity_feed' %}" class="link link-primary text-xs">
                                                    View full activity feed →
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Profile Completion -->
                        {% if can_edit and completion_percentage < 100 %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body">
                                    <h2 class="card-title text-warning">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        Profile Completion
                                    </h2>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <span data-completion-percentage>{{ completion_percentage }}% Complete</span>
                                            <span class="text-sm text-base-content/70">{{ remaining_percentage }}% to go</span>
                                        </div>
                                        <progress class="progress progress-primary w-full" value="{{ completion_percentage }}" max="100"></progress>
                                        
                                        {% if completion_suggestions %}
                                            <div class="space-y-2" data-completion-suggestions>
                                                <h3 class="font-semibold text-sm">Quick wins:</h3>
                                                {% for suggestion in completion_suggestions|slice:":3" %}
                                                    <div class="flex items-center gap-2 text-sm">
                                                        <i class="fas fa-lightbulb text-warning"></i>
                                                        {{ suggestion.message }}
                                                        <span class="badge badge-warning badge-xs">+{{ suggestion.weight }}%</span>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            <div class="space-y-2" data-completion-suggestions>
                                                <div class="text-center py-4">
                                                    <div class="text-2xl mb-2">🎉</div>
                                                    <p class="text-sm font-semibold text-success">Profile Complete!</p>
                                                    <p class="text-xs text-base-content/70">Your profile is fully filled out</p>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Social Links -->
                        {% if social_links %}
                            <div class="profile-section card bg-base-100 shadow-lg">
                                <div class="card-body">
                                    <h2 class="card-title text-info">
                                        <i class="fas fa-share-alt mr-2"></i>
                                        Social Links
                                    </h2>
                                    <div class="space-y-3">
                                        {% for platform, link in social_links.items %}
                                            <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" 
                                               class="social-link flex items-center gap-3 p-3 rounded-lg bg-base-200 hover:bg-base-300 transition-colors">
                                                <i class="{{ link.icon }} text-lg"></i>
                                                <span>{{ link.display }}</span>
                                                <i class="fas fa-external-link-alt ml-auto text-xs opacity-50"></i>
                                            </a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Skater Info -->
                        <div class="profile-section card bg-base-100 shadow-lg">
                            <div class="card-body p-3 sm:p-4 lg:p-6">
                                <h2 class="card-title text-accent text-sm sm:text-base">
                                    <i class="fas fa-info-circle mr-1 sm:mr-2"></i>
                                    Skater Info
                                </h2>
                                <div class="stats stats-vertical">
                                    <div class="stat p-2 sm:p-3">
                                        <div class="stat-title text-xs">Member Since</div>
                                        <div class="stat-value text-sm sm:text-base">{{ profile.created_at|date:"M Y" }}</div>
                                        <div class="stat-desc text-xs hidden sm:block">{{ profile.created_at|timesince }} ago</div>
                                    </div>
                                    
                                    {% if profile.years_skating %}
                                        <div class="stat p-2 sm:p-3">
                                            <div class="stat-title text-xs">Skating Experience</div>
                                            <div class="stat-value text-sm sm:text-base">{{ profile.years_skating }} year{{ profile.years_skating|pluralize }}</div>
                                            <div class="stat-desc text-xs hidden sm:block">On wheels</div>
                                        </div>
                                    {% endif %}
                                    
                                    {% if profile.verification_status != 'UNVERIFIED' %}
                                        <div class="stat p-2 sm:p-3">
                                            <div class="stat-title text-xs">Status</div>
                                            <div class="stat-value text-xs sm:text-base flex items-center gap-1 sm:gap-2">
                                                <i class="fas fa-check-circle text-success text-xs sm:text-sm"></i>
                                                <span class="text-xs sm:text-sm">{{ profile.get_verification_status_display }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="stat p-2 sm:p-3">
                                        <div class="stat-title text-xs">Last Active</div>
                                        <div class="stat-value text-sm sm:text-base">{{ profile.updated_at|timesince }} ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Events Section -->
                <div class="divider my-6 sm:my-8 lg:my-12">
                    <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-primary flex items-center gap-2 sm:gap-3">
                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar text-white text-sm sm:text-base"></i>
                        </div>
                        All Events
                        <span class="text-xs sm:text-sm font-normal text-base-content/60 hidden sm:inline">
                            🛹 Sessions & Competitions
                        </span>
                    </h2>
                </div>
                {% include 'profiles/partials/events_tab.html' %}
                
                <!-- Activity Section -->
                <div class="divider my-6 sm:my-8 lg:my-12">
                    <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-primary flex items-center gap-2 sm:gap-3">
                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-secondary rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-sm sm:text-base"></i>
                        </div>
                        Activity Timeline
                    </h2>
                    <span class="text-xs sm:text-sm font-normal text-base-content/60 hidden sm:inline">
                        📈 Your Skateboarding Journey
                    </span>
                </div>
                {% include 'profiles/partials/activity_tab.html' %}
                
                <!-- Social Section -->
                {% if profile.get_social_links %}
                    <div class="divider my-6 sm:my-8 lg:my-12">
                        <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-primary flex items-center gap-2 sm:gap-3">
                            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-info rounded-lg flex items-center justify-center">
                                <i class="fas fa-share-alt text-white text-sm sm:text-base"></i>
                            </div>
                            Social Media
                            <span class="text-xs sm:text-sm font-normal text-base-content/60 hidden sm:inline">
                                🌐 Connect & Follow
                            </span>
                        </h2>
                    </div>
                    {% include 'profiles/partials/social_tab.html' %}
                {% endif %}
                
                <!-- Settings Section -->
                {% if can_edit %}
                    <div class="divider my-6 sm:my-8 lg:my-12" id="profile-settings" data-section="settings">
                        <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-primary flex items-center gap-2 sm:gap-3">
                            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-accent rounded-lg flex items-center justify-center">
                                <i class="fas fa-cog text-white text-sm sm:text-base"></i>
                            </div>
                            Profile Settings
                            <span class="text-xs sm:text-sm font-normal text-base-content/60 hidden sm:inline">
                                ⚙️ Privacy & Preferences
                            </span>
                        </h2>
                    </div>
                    {% include 'profiles/partials/settings_tab.html' %}
                {% endif %}
            </div>
        </div>
    </section>
</div>

<!-- Modals -->
{% if can_edit %}
    {% include 'profiles/partials/avatar_modal.html' %}
    {# Removed edit_modal.html - using settings tab instead #}
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// Scroll to settings section
function scrollToSettings() {
    const settingsSection = document.getElementById('profile-settings') || 
                          document.querySelector('[data-section="settings"]');
    
    if (settingsSection) {
        settingsSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
        
        // Add a subtle highlight effect
        settingsSection.style.transition = 'all 0.3s ease';
        settingsSection.style.backgroundColor = 'rgba(var(--p), 0.1)';
        settingsSection.style.borderRadius = '0.5rem';
        settingsSection.style.padding = '1rem';
        setTimeout(() => {
            settingsSection.style.backgroundColor = '';
            settingsSection.style.padding = '';
        }, 2000);
    } else {
        // Fallback: scroll to bottom of page where settings usually are
        window.scrollTo({ 
            top: document.body.scrollHeight - window.innerHeight, 
            behavior: 'smooth' 
        });
    }
}

// Live update functions for profile display
function updateProfileDisplay(field, value, displayValue = null) {
    const elements = document.querySelectorAll(`[data-profile-display="${field}"]`);
    const actualDisplayValue = displayValue || value;
    
    elements.forEach(element => {
        switch(field) {
            case 'display_name':
                element.textContent = actualDisplayValue || document.querySelector('[data-profile-display="username"]')?.textContent || 'User';
                break;
            case 'bio':
                if (actualDisplayValue) {
                    element.textContent = actualDisplayValue;
                    element.classList.remove('text-base-content/60', 'italic');
                } else {
                    element.textContent = 'Add a bio 🎯';
                    element.classList.add('text-base-content/60', 'italic');
                }
                break;
            case 'city':
            case 'country':
                updateLocationDisplay();
                break;
            case 'skating_style':
                element.textContent = actualDisplayValue || 'Not specified';
                // Also update the skating style badge visibility
                updateSkatingBadges();
                break;
            case 'skill_level':
                element.textContent = value ? `${value}/10` : 'Not specified';
                updateSkatingBadges();
                break;
            case 'years_skating':
                if (value) {
                    element.textContent = `${value}yr${value == 1 ? '' : 's'}`;
                } else {
                    element.textContent = 'Not specified';
                }
                updateSkatingBadges();
                break;
            case 'stance':
                element.textContent = actualDisplayValue || 'Not specified';
                updateSkatingBadges();
                break;
            case 'primary_setup':
                if (actualDisplayValue) {
                    element.textContent = actualDisplayValue;
                    element.classList.remove('text-base-content/60', 'italic');
                } else {
                    element.textContent = 'No setup information';
                    element.classList.add('text-base-content/60', 'italic');
                }
                break;
        }
    });
}

// Update skateboarding badges visibility and content
function updateSkatingBadges() {
    const badgesContainer = document.querySelector('.flex.flex-wrap.gap-1') || 
                          document.querySelector('div:has([data-profile-display="skating_style"])') ||
                          document.querySelector('.skating-style-badge')?.parentElement;
    
    if (!badgesContainer) return;
    
    // Get current values from settings fields
    const skatingStyleField = document.querySelector('select[data-field="skating_style"]');
    const skillLevelField = document.querySelector('input[data-field="skill_level"]');
    const yearsSkatingField = document.querySelector('input[data-field="years_skating"]');
    const stanceField = document.querySelector('select[data-field="stance"]');
    
    const skatingStyle = skatingStyleField ? skatingStyleField.value : '';
    const skillLevel = skillLevelField ? skillLevelField.value : '';
    const yearsSkating = yearsSkatingField ? yearsSkatingField.value : '';
    const stance = stanceField ? stanceField.value : '';
    
    // Clear existing badges
    badgesContainer.innerHTML = '';
    
    // Add skating style badge if present
    if (skatingStyle) {
        const styleOption = skatingStyleField.querySelector(`option[value="${skatingStyle}"]`);
        const styleDisplay = styleOption ? styleOption.textContent : skatingStyle;
        badgesContainer.innerHTML += `
            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm font-semibold">
                <span data-profile-display="skating_style">${styleDisplay}</span> Skater
            </span>
        `;
    }
    
    // Add stance badge if present
    if (stance) {
        const stanceOption = stanceField.querySelector(`option[value="${stance}"]`);
        const stanceDisplay = stanceOption ? stanceOption.textContent : stance;
        badgesContainer.innerHTML += `
            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                <span data-profile-display="stance">${stanceDisplay}</span> Stance
            </span>
        `;
    }
    
    // Add years skating badge if present
    if (yearsSkating) {
        badgesContainer.innerHTML += `
            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                <span data-profile-display="years_skating">${yearsSkating}yr${yearsSkating == 1 ? '' : 's'}</span> exp
            </span>
        `;
    }
    
    // Add skill level badge if present
    if (skillLevel) {
        badgesContainer.innerHTML += `
            <span class="skating-style-badge px-2 py-1 rounded-full text-xs sm:text-sm">
                Level <span data-profile-display="skill_level">${skillLevel}/10</span>
            </span>
        `;
    }
}

function updateLocationDisplay() {
    const cityField = document.querySelector('input[data-field="city"]');
    const countryField = document.querySelector('input[data-field="country"]');
    
    const city = cityField ? cityField.value.trim() : '';
    const country = countryField ? countryField.value.trim() : '';
    const locationText = [city, country].filter(Boolean).join(', ');
    
    // Find all location display elements
    const locationElements = document.querySelectorAll('[data-profile-display="location"]');
    const locationParagraphs = document.querySelectorAll('p:has([data-profile-display="location"])');
    
    locationElements.forEach(el => {
        if (locationText) {
            el.textContent = locationText;
            el.classList.remove('text-base-content/60');
            
            // Show the parent paragraph if it was hidden
            const parentP = el.closest('p');
            if (parentP) {
                parentP.classList.remove('hidden');
            }
        } else {
            el.textContent = 'Location not specified';
            el.classList.add('text-base-content/60');
            
            // Handle showing/hiding based on edit permissions
            const parentP = el.closest('p');
            if (parentP) {
                // If user can't edit and no location, hide the paragraph
                const canEdit = document.querySelector('[onclick="scrollToSettings()"]') !== null;
                if (!canEdit) {
                    parentP.classList.add('hidden');
                } else {
                    parentP.classList.remove('hidden');
                }
            }
        }
    });
}

// Toast notification function
function showToast(message, type = 'info', duration = 3000) {
    // Remove existing toasts
    document.querySelectorAll('.toast').forEach(toast => toast.remove());
    
    const toast = document.createElement('div');
    toast.className = `toast toast-top toast-end z-50`;
    
    const alertClass = type === 'success' ? 'alert-success' : 
                      type === 'error' ? 'alert-error' : 
                      type === 'warning' ? 'alert-warning' : 'alert-info';
    
    const iconClass = type === 'success' ? 'fas fa-check-circle' : 
                      type === 'error' ? 'fas fa-exclamation-circle' : 
                      type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle';
    
    toast.innerHTML = `
        <div class="alert ${alertClass}">
            <i class="${iconClass}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, duration);
}

// Edit mode functionality (legacy - keeping for compatibility)
let editMode = false;

function toggleEditMode() {
    editMode = !editMode;
    const editableElements = document.querySelectorAll('[data-editable]');
    
    editableElements.forEach(element => {
        if (editMode) {
            element.classList.add('profile-editable');
            element.title = 'Click to edit';
        } else {
            element.classList.remove('profile-editable');
            element.title = '';
        }
    });
    
    // Show/hide edit overlays
    const editOverlays = document.querySelectorAll('.profile-edit-overlay');
    editOverlays.forEach(overlay => {
        overlay.style.display = editMode ? 'flex' : 'none';
    });
}

// Profile field editing
function editField(fieldName, currentValue) {
    const modal = document.createElement('div');
    modal.className = 'modal modal-open';
    modal.innerHTML = `
        <div class="modal-box">
            <h3 class="font-bold text-lg">Edit ${fieldName.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</h3>
            <div class="py-4">
                <label class="label">
                    <span class="label-text">New value:</span>
                </label>
                <input type="text" id="edit-field-input" class="input input-bordered w-full" value="${currentValue}">
            </div>
            <div class="modal-action">
                <button class="btn" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveField('${fieldName}')">Save</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.getElementById('edit-field-input').focus();
}

function saveField(fieldName) {
    const input = document.getElementById('edit-field-input');
    const value = input.value;
    
    fetch('{% url "profiles:update_profile_api" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            field: fieldName,
            value: value
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while saving.');
    });
    
    closeEditModal();
}

function closeEditModal() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (modal.classList.contains('modal-open')) {
            modal.remove();
        }
    });
}

// Add smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
            behavior: 'smooth'
        });
    });
});

// Global completion progress update function
window.updateCompletionProgress = function(newPercentage) {
    // Update progress bar
    const progressBars = document.querySelectorAll('progress.progress-primary');
    progressBars.forEach(bar => {
        bar.value = newPercentage;
    });
    
    // Update percentage text
    const percentageElements = document.querySelectorAll('[data-completion-percentage]');
    percentageElements.forEach(el => {
        el.textContent = `${newPercentage}% Complete`;
    });
    
    // Update completion text in various places
    const completionTexts = document.querySelectorAll('[data-completion-text]');
    completionTexts.forEach(el => {
        if (newPercentage >= 100) {
            el.textContent = 'Perfect! Your profile is complete!';
        } else if (newPercentage >= 80) {
            el.textContent = 'Excellent! Your profile is almost complete.';
        } else if (newPercentage >= 50) {
            el.textContent = 'Good progress! Keep filling out your profile.';
        } else {
            el.textContent = 'Complete your profile to get more visibility.';
        }
    });
    
    // Update completion section visibility
    const completionSection = document.querySelector('.profile-section:has([data-completion-percentage])');
    if (completionSection) {
        if (newPercentage >= 100) {
            // Hide the completion section since profile is complete
            completionSection.style.display = 'none';
        } else {
            // Show the completion section if it was hidden
            completionSection.style.display = 'block';
        }
    }
    
    // Fetch updated completion suggestions
    fetch('{% url "profiles:completion_suggestions" %}')
        .then(response => response.json())
        .then(data => {
            const suggestionsContainer = document.querySelector('[data-completion-suggestions]');
            if (!suggestionsContainer) return;
            
            if (data.suggestions.length === 0 || newPercentage >= 100) {
                suggestionsContainer.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-2xl mb-2">🎉</div>
                        <p class="text-sm font-semibold text-success">Profile Complete!</p>
                        <p class="text-xs text-base-content/70">Your profile is fully filled out</p>
                    </div>
                `;
            } else {
                const suggestionsHTML = data.suggestions.slice(0, 3).map(suggestion => `
                    <div class="flex items-center gap-2 text-sm">
                        <i class="fas fa-lightbulb text-warning"></i>
                        ${suggestion.message || suggestion.title}
                        <span class="badge badge-warning badge-xs">+${suggestion.weight || suggestion.points}%</span>
                    </div>
                `).join('');
                
                suggestionsContainer.innerHTML = `
                    <h3 class="font-semibold text-sm">Quick wins:</h3>
                    ${suggestionsHTML}
                `;
            }
        })
        .catch(error => console.error('Error fetching suggestions:', error));
    
    // Check if profile is complete and show celebration
    if (newPercentage >= 100) {
        showProfileCompleteAnimation();
    }
};

// Profile completion celebration animation (global function)
window.showProfileCompleteAnimation = function() {
    // Don't show animation if already shown recently
    if (sessionStorage.getItem('profileCompleteShown')) {
        return;
    }
    
    // Mark as shown for this session
    sessionStorage.setItem('profileCompleteShown', 'true');
    
    // Create confetti effect
    createConfetti();
    
    // Show celebration toast
    if (window.showToast) {
        window.showToast('🎉 Congratulations! Your profile is now 100% complete!', 'success', 5000);
    }
    
    // Create a celebration modal
    const celebrationModal = document.createElement('div');
    celebrationModal.className = 'modal modal-open';
    celebrationModal.innerHTML = `
        <div class="modal-box text-center">
            <div class="text-6xl mb-4">🎉</div>
            <h3 class="font-bold text-xl mb-4">Profile Complete!</h3>
            <p class="py-4">
                Awesome work! Your skateboarding profile is now 100% complete. 
                You'll get better visibility and more connections with other riders.
            </p>
            <div class="modal-action justify-center">
                <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                    Sweet! Let's Ride! 🛹
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(celebrationModal);
    
    // Auto-close after 8 seconds
    setTimeout(() => {
        if (celebrationModal.parentNode) {
            celebrationModal.remove();
        }
    }, 8000);
};

// Confetti animation function (global)
function createConfetti() {
    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
    const confettiContainer = document.createElement('div');
    confettiContainer.style.position = 'fixed';
    confettiContainer.style.top = '0';
    confettiContainer.style.left = '0';
    confettiContainer.style.width = '100%';
    confettiContainer.style.height = '100%';
    confettiContainer.style.pointerEvents = 'none';
    confettiContainer.style.zIndex = '9999';
    document.body.appendChild(confettiContainer);
    
    // Create confetti pieces
    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'absolute';
        confetti.style.width = '10px';
        confetti.style.height = '10px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = '-10px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.opacity = Math.random();
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        confettiContainer.appendChild(confetti);
        
        // Animate the confetti
        const duration = Math.random() * 3000 + 2000; // 2-5 seconds
        const horizontalMovement = (Math.random() - 0.5) * 200; // -100px to 100px
        
        confetti.animate([
            { 
                transform: `translateY(0px) translateX(0px) rotate(0deg)`,
                opacity: confetti.style.opacity
            },
            { 
                transform: `translateY(${window.innerHeight + 20}px) translateX(${horizontalMovement}px) rotate(720deg)`,
                opacity: '0'
            }
        ], {
            duration: duration,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        });
        
        // Remove confetti piece after animation
        setTimeout(() => {
            if (confetti.parentNode) {
                confetti.remove();
            }
        }, duration);
    }
    
    // Remove container after all animations complete
    setTimeout(() => {
        if (confettiContainer.parentNode) {
            confettiContainer.remove();
        }
    }, 6000);
}
</script>
{% endblock %}
