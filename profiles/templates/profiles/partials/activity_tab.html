<!-- Activity Tab Content -->
<div class="space-y-6">
    <!-- Activity Filter -->
    <div class="flex flex-wrap gap-2 mb-6">
        <button class="btn btn-sm btn-primary activity-filter-btn active" data-filter="all">
            All Activity
        </button>
        <button class="btn btn-sm btn-outline activity-filter-btn" data-filter="events">
            <i class="fas fa-calendar mr-1"></i>
            Events
        </button>
        <button class="btn btn-sm btn-outline activity-filter-btn" data-filter="reviews">
            <i class="fas fa-star mr-1"></i>
            Reviews
        </button>
        <button class="btn btn-sm btn-outline activity-filter-btn" data-filter="achievements">
            <i class="fas fa-trophy mr-1"></i>
            Achievements
        </button>
        <button class="btn btn-sm btn-outline activity-filter-btn" data-filter="social">
            <i class="fas fa-users mr-1"></i>
            Social
        </button>
    </div>
    
    <!-- Activity Timeline -->
    <div class="activity-timeline">
        <!-- Recent Reviews -->
        {% if user_reviews %}
            <div class="activity-section" data-activity-type="reviews">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 mt-4">
                    <i class="fas fa-star text-warning"></i>
                    Recent Reviews
                </h3>
                
                <div class="space-y-4">
                    {% for review in user_reviews %}
                        <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-warning">
                            <div class="card-body p-4">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <div class="rating rating-sm">
                                            {% for i in "12345" %}
                                                <input type="radio" class="mask mask-star-2 bg-warning" 
                                                       {% if forloop.counter <= review.rating %}checked{% endif %} disabled />
                                            {% endfor %}
                                        </div>
                                        <span class="font-semibold">{{ review.rating }}/5</span>
                                    </div>
                                    <span class="text-sm text-base-content/60">{{ review.created_at|timesince }} ago</span>
                                </div>
                                
                                <h4 class="font-semibold text-primary mb-2">
                                    <a href="{% url 'events:event_details' review.event.slug %}" class="hover:underline">
                                        {{ review.event.name }}
                                    </a>
                                </h4>
                                
                                {% if review.comment %}
                                    <p class="text-base-content/80 text-sm">{{ review.comment|truncatechars:150 }}</p>
                                {% endif %}
                                
                                <div class="flex items-center justify-between mt-3">
                                    <div class="flex items-center gap-4 text-xs text-base-content/60">
                                        <span><i class="fas fa-calendar mr-1"></i>{{ review.event.date|date:"M d, Y" }}</span>
                                        {% if review.helpful_count %}
                                            <span><i class="fas fa-thumbs-up mr-1"></i>{{ review.helpful_count }} helpful</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if can_edit %}
                                        <div class="dropdown dropdown-end">
                                            <label tabindex="0" class="btn btn-xs btn-ghost">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </label>
                                            <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-32">
                                                <li><a onclick="editReview({{ review.id }})"><i class="fas fa-edit mr-2"></i>Edit</a></li>
                                                <li><a onclick="deleteReview({{ review.id }})" class="text-error"><i class="fas fa-trash mr-2"></i>Delete</a></li>
                                            </ul>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        
        <!-- Event Activity -->
         {% if user_attending_events or user_organized_events %}
        <div class="activity-section" data-activity-type="events">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 mt-4">
                <i class="fas fa-calendar-alt text-primary"></i>
                Event Activity
            </h3>
            
            <div class="space-y-4">
                <!-- Recent Event Participations -->
                {% for event in user_attending_events|slice:":5" %}
                    <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-secondary">
                        <div class="card-body p-4">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-secondary rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-check text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold">
                                            Joined <a href="{% url 'events:event_details' event.slug %}" class="text-primary hover:underline">{{ event.name }}</a>
                                        </p>
                                        <div class="flex items-center gap-4 text-sm text-base-content/60 mt-1">
                                            <span><i class="fas fa-calendar mr-1"></i>{{ event.date|date:"M d, Y" }}</span>
                                            <span><i class="fas fa-map-marker-alt mr-1"></i>{{ event.location|default:"TBD" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="text-sm text-base-content/60">{{ event.rsvp_date|timesince }} ago</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                
                <!-- Recent Event Creations -->
                {% for event in user_organized_events|slice:":5" %}
                    <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-primary">
                        <div class="card-body p-4">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center">
                                        <i class="fas fa-crown text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold">
                                            Created <a href="{% url 'events:event_details' event.slug %}" class="text-primary hover:underline">{{ event.name }}</a>
                                        </p>
                                        <div class="flex items-center gap-4 text-sm text-base-content/60 mt-1">
                                            <span><i class="fas fa-calendar mr-1"></i>{{ event.date|date:"M d, Y" }}</span>
                                            <span><i class="fas fa-users mr-1"></i>{{ event.participants_count|default:0 }} participants</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="text-sm text-base-content/60">{{ event.created_at|timesince }} ago</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        <!-- Achievements -->
        <div class="activity-section" data-activity-type="achievements">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 mt-4">
                <i class="fas fa-trophy text-accent"></i>
                Achievements & Milestones
            </h3>
            
            <div class="space-y-4">
                <!-- Profile Milestones -->
                <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-accent">
                    <div class="card-body p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-accent rounded-full flex items-center justify-center">
                                <i class="fas fa-user-check text-white"></i>
                            </div>
                            <div>
                                <p class="font-semibold">Profile {{ completion_percentage }}% Complete</p>
                                <p class="text-sm text-base-content/60">
                                    {% if completion_percentage >= 80 %}
                                        Your profile is looking great! 
                                    {% elif completion_percentage >= 50 %}
                                        You're making good progress on your profile.
                                    {% else %}
                                        Complete your profile to get more visibility.
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Completion Progress</span>
                                <span>{{ completion_percentage }}%</span>
                            </div>
                            <progress class="progress progress-accent w-full" value="{{ completion_percentage }}" max="100"></progress>
                        </div>
                    </div>
                </div>
                
                <!-- Event Milestones -->
                {% if user_organized_events|length > 0 or user_attending_events|length > 0 %}
                    <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-success">
                        <div class="card-body p-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-success rounded-full flex items-center justify-center">
                                    <i class="fas fa-medal text-white"></i>
                                </div>
                                <div>
                                    <p class="font-semibold">Event Participation Milestone</p>
                                    <p class="text-sm text-base-content/60">
                                        Participated in {{ user_attending_events|length|add:user_organized_events|length }} events total
                                    </p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mt-3">
                                <div class="stat">
                                    <div class="stat-value text-lg text-primary">{{ user_organized_events|length }}</div>
                                    <div class="stat-desc">Organized</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value text-lg text-secondary">{{ user_attending_events|length }}</div>
                                    <div class="stat-desc">Attended</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Member Since -->
                <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-info">
                    <div class="card-body p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-info rounded-full flex items-center justify-center">
                                <i class="fas fa-birthday-cake text-white"></i>
                            </div>
                            <div>
                                <p class="font-semibold">Community Member</p>
                                <p class="text-sm text-base-content/60">
                                    Joined {{ profile.created_at|date:"F Y" }} â€¢ Member for {{ profile.created_at|timesince }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Social Activity -->
        <div class="activity-section" data-activity-type="social">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 mt-4">
                <i class="fas fa-users text-info"></i>
                Social Activity
            </h3>
            
            <div class="space-y-4">
                <!-- Social Links Added -->
                {% if social_links %}
                    <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-info">
                        <div class="card-body p-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-info rounded-full flex items-center justify-center">
                                    <i class="fas fa-link text-white"></i>
                                </div>
                                <div>
                                    <p class="font-semibold">Connected Social Accounts</p>
                                    <p class="text-sm text-base-content/60">
                                        {{ social_links|length }} social account{{ social_links|length|pluralize }} connected
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2 mt-3">
                                {% for platform, link in social_links.items %}
                                    <div class="badge badge-info gap-1">
                                        <i class="{{ link.icon }}"></i>
                                        {{ platform|capfirst }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Profile Views (placeholder for future feature) -->
                <div class="activity-item card bg-base-100 shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-neutral">
                    <div class="card-body p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-neutral rounded-full flex items-center justify-center">
                                <i class="fas fa-eye text-white"></i>
                            </div>
                            <div>
                                <p class="font-semibold">Profile Visibility</p>
                                <p class="text-sm text-base-content/60">
                                    Profile is {{ profile.get_profile_visibility_display|lower }}
                                    {% if profile.profile_visibility == 'PUBLIC' %}
                                        - visible to everyone
                                    {% elif profile.profile_visibility == 'COMMUNITY' %}
                                        - visible to community members
                                    {% elif profile.profile_visibility == 'CREWS' %}
                                        - visible to crew members only
                                    {% else %}
                                        - private
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Empty State -->
        {% if not user_reviews and not user_attending_events and not user_organized_events %}
            <div class="text-center py-12">
                <i class="fas fa-history text-4xl text-base-content/30 mb-4"></i>
                <p class="text-base-content/60 mb-4">
                    {% if can_edit %}
                        No activity yet. Start by joining events or creating your first event!
                    {% else %}
                        {{ profile.get_display_name }} hasn't been active yet.
                    {% endif %}
                </p>
                {% if can_edit %}
                    <div class="space-x-2">
                        <a href="{% url 'events:event_list' %}" class="btn btn-primary">
                            <i class="fas fa-calendar mr-2"></i>
                            Browse Events
                        </a>
                        <a href="{% url 'events:submit' %}" class="btn btn-secondary">
                            <i class="fas fa-plus mr-2"></i>
                            Create Event
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<script>
// Activity filtering
document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.activity-filter-btn');
    const activitySections = document.querySelectorAll('.activity-section');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update button states
            filterButtons.forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            });
            this.classList.add('btn-primary');
            this.classList.remove('btn-outline');
            
            // Show/hide sections based on filter
            activitySections.forEach(section => {
                if (filter === 'all') {
                    section.style.display = 'block';
                } else {
                    const sectionType = section.dataset.activityType;
                    if (sectionType === filter) {
                        section.style.display = 'block';
                    } else {
                        section.style.display = 'none';
                    }
                }
            });
        });
    });
});

// Review management functions
function editReview(reviewId) {
    // Implementation for editing reviews
    console.log('Edit review:', reviewId);
    // This would open a modal for editing the review
}

function deleteReview(reviewId) {
    if (!confirm('Are you sure you want to delete this review?')) {
        return;
    }
    
    // Implementation for deleting reviews
    fetch(`/reviews/${reviewId}/delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error deleting review');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while deleting the review.');
    });
}
</script>
