{% extends 'base.html' %}
{% load static %}

{% block title %}{{ block.super }} - {{ league.name }} Standings{% endblock %}
{% block meta_description %}View the current standings and events for the {{ league.name }} downhill skateboarding league.{% endblock %}

{% block content %}
<!-- League header with banner -->
<div class="relative">
    <div class="h-64 w-full overflow-hidden bg-base-300">
        {% if league.banner %}
        <img src="{{ league.banner.url }}" alt="{{ league.name }} banner" class="w-full h-full object-cover opacity-30">
        {% endif %}
        <div class="absolute inset-0 bg-gradient-to-t from-base-300 to-transparent"></div>
    
        <!-- League logo positioned at far right to avoid overlap -->
        <div class="absolute bottom-6 right-8">
            {% if league.logo %}
            <img src="{{ league.logo.url }}" alt="{{ league.name }} logo" class="w-28 h-28 object-contain">
            {% else %}
            <div class="w-28 h-28 flex items-center justify-center">
                <i class="fas fa-trophy text-5xl text-primary"></i>
            </div>
            {% endif %}
        </div>
        
        <!-- League name and info with improved padding -->
        <div class="absolute bottom-6 left-8 pr-40">
            <h1 class="text-4xl md:text-5xl font-bold text-base-content drop-shadow-lg mb-2">{{ league.name }}</h1>
            <div class="flex gap-3 mt-3">
                <div class="badge badge-primary badge-lg">{{ league.get_league_class_display }}</div>
                {% if league.country %}
                <div class="badge badge-secondary badge-lg">{{ league.country.name }}</div>
                {% endif %}
                <div class="badge badge-ghost badge-lg">{{ league.events.count }} Events</div>
            </div>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 bg-base-300 max-w-[1400px] p-8">
    <!-- About Section -->
    {% if league.description %}
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4">About this League</h2>
        <div class="prose max-w-none bg-base-100 p-6 rounded-lg shadow">
            <p>{{ league.description }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Standings Section -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Standings</h2>
        <div class="overflow-x-auto bg-base-100 p-6 rounded-lg shadow">
            <table class="table table-zebra w-full">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Rider</th>
                        <th class="text-center">Points</th>
                        <th class="text-center">Events</th>
                    </tr>
                </thead>
                <tbody>
                    {% for standing in standings %}
                    <tr>
                        <td>{{ standing.position }}</td>
                        <td>
                            <a href="{% url 'profiles:user_profile' standing.competitor.user.username %}" 
                               class="flex items-center space-x-3 hover:opacity-80 transition-opacity">
                                <div class="avatar">
                                    <div class="mask mask-squircle w-12 h-12">
                                        <img src="{{ standing.competitor.avatar.url|default:'/static/images/default-profile.webp' }}" 
                                             alt="{{ standing.competitor.user.get_full_name }}" />
                                    </div>
                                </div>
                                <div>{{ standing.competitor.user.get_full_name }}</div>
                            </a>
                        </td>
                        <td class="text-center">
                            <div class="badge badge-primary">{{ standing.points }}</div>
                        </td>
                        <td class="text-center">
                            <div class="badge badge-ghost">{{ standing.events_competed }}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- League Events Section -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4">League Events</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for event in league.events.all %}
                {% include "results/partials/_results_event_card.html" with event=event %}
            {% empty %}
                <div class="col-span-3">
                    <div class="alert alert-info">
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span>No events have been added to this league yet.</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
