{% extends 'base.html' %}
{% load static %}
{% load countries %}
{% load i18n %}

{% block title %}{{ block.super }} - Skateboarding Leagues{% endblock %}
{% block meta_description %}View all active downhill skateboarding leagues and their standings.{% endblock %}

{% block extra_css %}
<link href="{% static 'css/swiper-bundle.min.css' %}" rel="stylesheet">
<link href="{% static 'css/swiper_slider.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Hero slider for leagues -->
<div class="hero-container z-10">
  <div class="hero-slider swiper">
    <div class="swiper-wrapper">
      {% if leagues %}
        {% for league in leagues|slice:":5" %}
        <div class="swiper-slide hero-slide">
          <a href="{% url 'results:league_standings' league.slug %}">
            {% if league.banner %}
            <img src="{{ league.banner.url }}" alt="{{ league.name }}" class="hero-image">
            {% else %}
            <img src="{% static 'images/sdh-bg-wpopo-100q.webp' %}" alt="{{ league.name }}" class="hero-image">
            {% endif %}
            <div class="hero-content">
              <h2 class="hero-title text-2xl md:text-3xl font-bold mb-2">{{ league.name }}</h2>
              <div class="hero-info text-sm md:text-base">
                {% if league.country %}{{ league.country.name }} • {% endif %}{{ league.get_league_class_display }} • {{ league.events.count }} Events
              </div>
            </div>
          </a>
        </div>
        {% endfor %}
      {% else %}
        <div class="swiper-slide hero-slide">
          <img src="{% static 'images/sdh-bg-wpopo-100q.webp' %}" alt="Skateboarding Leagues" class="hero-image">
          <div class="hero-content">
            <h2 class="hero-title text-2xl md:text-3xl font-bold mb-2">Skateboarding Leagues</h2>
            <div class="hero-info text-sm md:text-base">
              Join competitive skateboarding leagues and track your standings
            </div>
          </div>
        </div>
      {% endif %}
    </div>
    <div class="theme-gradient-overlay"></div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
</div>

<!-- Main container -->
<div class="container mx-auto px-4 max-w-[1400px] relative z-20">
  <!-- Filter Form -->
  <form method="get" class="flex flex-wrap gap-2 items-center mb-4 rounded-lg">
    <div class="flex-1 flex flex-wrap gap-2 items-center">
        <select id="year" name="year" class="select select-sm select-bordered w-20 sm:w-20 text-xs p-0 pl-2">
            {% for year in available_years %}
                <option value="{{ year }}" {% if year == current_year %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
        </select>

        <input type="text" id="name" name="name" 
            class="input input-sm input-bordered w-24 sm:w-40 text-xs placeholder:text-xs p-0 pl-2" 
            placeholder="League name"
            value="{{ request.GET.name|default:'' }}">
        
        <select id="league_class" name="league_class" class="select select-sm select-bordered w-20 sm:w-40 text-xs p-0 pl-2">
            <option value="">League Class</option>
            <option value="LOCAL" {% if request.GET.league_class == 'LOCAL' %}selected{% endif %}>Local</option>
            <option value="REGIONAL" {% if request.GET.league_class == 'REGIONAL' %}selected{% endif %}>Regional</option>
            <option value="NATIONAL" {% if request.GET.league_class == 'NATIONAL' %}selected{% endif %}>National</option>
            <option value="CONTINENTAL" {% if request.GET.league_class == 'CONTINENTAL' %}selected{% endif %}>Continental</option>
            <option value="WORLD" {% if request.GET.league_class == 'WORLD' %}selected{% endif %}>World</option>
        </select>

        <select id="country" name="country" class="select select-sm select-bordered w-20 sm:w-40 text-xs p-0 pl-2">
            <option value="">Country</option>
            {% for code, name in countries %}
                <option value="{{ code }}" {% if request.GET.country == code %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>

        <select id="continent" name="continent" class="select select-sm select-bordered w-20 sm:w-40 text-xs p-0 pl-2">
            <option value="">Continent</option>
            {% for code, name in continents %}
                <option value="{{ code }}" {% if request.GET.continent == code %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
        
        <select id="events_count" name="events_count" class="select select-sm select-bordered w-20 sm:w-40 text-xs p-0 pl-2">
            <option value="">Events Count</option>
            <option value="1" {% if request.GET.events_count == '1' %}selected{% endif %}>At least 1</option>
            <option value="5" {% if request.GET.events_count == '5' %}selected{% endif %}>At least 5</option>
            <option value="10" {% if request.GET.events_count == '10' %}selected{% endif %}>At least 10</option>
        </select>
        
        <button type="submit" class="btn btn-sm btn-primary text-xs">Filter</button>
        <a href="{% url 'results:league_list' %}" class="btn btn-sm btn-ghost text-xs">Clear</a>
    </div>
</form>

  <!-- League Cards -->
  {% if leagues %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for league in leagues %}
        {% include 'results/partials/_league_card.html' with league=league %}
      {% endfor %}
    </div>
  {% else %}
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <div class="alert alert-info shadow-lg">
          <div class="flex items-start space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-8 h-8 mt-1">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="flex-1">
              <h3 class="font-bold">No Leagues Available</h3>
              <div class="text-xs">There are currently no active leagues. Check back later!</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/swiper-bundle.min.js' %}"></script>
<script src="{% static 'js/theme_gradient.js' %}"></script>
<script>
  // Initialize Swiper slider
  const swiper = new Swiper('.hero-slider', {
    loop: true,
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    autoplay: {
      delay: 3000,
    },
    effect: 'fade',
    fadeEffect: {
      crossFade: true
    }
  });
</script>
{% endblock %}
