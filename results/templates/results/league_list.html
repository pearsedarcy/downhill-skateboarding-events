{% extends 'base.html' %}
{% load static %}
{% load countries %}
{% load i18n %}

{% block title %}{{ block.super }} - Skateboarding Leagues{% endblock %}
{% block meta_description %}View all active downhill skateboarding leagues and their standings.{% endblock %}

{% block extra_css %}
<link href="{% static 'css/swiper-bundle.min.css' %}" rel="stylesheet">
<link href="{% static 'css/swiper_slider.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Hero slider for leagues -->
<div class="hero-container z-10">
  <div class="hero-slider swiper">
    <div class="swiper-wrapper">
      {% if leagues %}
        {% for league in leagues|slice:":5" %}
        <div class="swiper-slide hero-slide">
          <a href="{% url 'results:league_standings' league.slug %}">
            {% if league.banner %}
            <img src="{{ league.banner.url }}" alt="{{ league.name }}" class="hero-image">
            {% else %}
            <img src="{% static 'images/sdh-bg-wpopo-100q.webp' %}" alt="{{ league.name }}" class="hero-image">
            {% endif %}
            <div class="hero-content">
              <h2 class="hero-title text-2xl md:text-3xl font-bold mb-2">{{ league.name }}</h2>
              <div class="hero-info text-sm md:text-base">
                {% if league.country %}{{ league.country.name }} • {% endif %}{{ league.get_league_class_display }} • {{ league.events.count }} Events
              </div>
            </div>
          </a>
        </div>
        {% endfor %}
      {% else %}
        <div class="swiper-slide hero-slide">
          <img src="{% static 'images/sdh-bg-wpopo-100q.webp' %}" alt="Skateboarding Leagues" class="hero-image">
          <div class="hero-content">
            <h2 class="hero-title text-2xl md:text-3xl font-bold mb-2">Skateboarding Leagues</h2>
            <div class="hero-info text-sm md:text-base">
              Join competitive skateboarding leagues and track your standings
            </div>
          </div>
        </div>
      {% endif %}
    </div>
    <div class="theme-gradient-overlay"></div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
</div>

<!-- Main container -->
<div class="container mx-auto px-4 max-w-[1400px] relative z-20">
  <!-- Filter Form -->
  <form method="get" class="flex flex-wrap gap-2 items-center mb-4 rounded-lg">
    <div class="flex-1 flex flex-wrap gap-2 items-center">
      <input type="text" id="name" name="name" 
        class="input input-sm input-bordered w-full sm:w-auto text-xs placeholder:text-xs p-0 pl-2" 
        placeholder="League name"
        value="{{ request.GET.name|default:'' }}">
      
      <select id="league_class" name="league_class" class="select select-sm select-bordered w-full sm:w-auto text-xs p-0 pl-2">
        <option value="">League Class</option>
        <option value="LOCAL" {% if request.GET.league_class == 'LOCAL' %}selected{% endif %}>Local</option>
        <option value="REGIONAL" {% if request.GET.league_class == 'REGIONAL' %}selected{% endif %}>Regional</option>
        <option value="NATIONAL" {% if request.GET.league_class == 'NATIONAL' %}selected{% endif %}>National</option>
        <option value="CONTINENTAL" {% if request.GET.league_class == 'CONTINENTAL' %}selected{% endif %}>Continental</option>
        <option value="WORLD" {% if request.GET.league_class == 'WORLD' %}selected{% endif %}>World</option>
      </select>

      <select id="country" name="country" class="select select-sm select-bordered w-full sm:w-auto text-xs p-0 pl-2">
        <option value="">Country</option>
        {% for code, name in countries %}
          <option value="{{ code }}" {% if request.GET.country == code %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>

      <select id="continent" name="continent" class="select select-sm select-bordered w-full sm:w-auto text-xs p-0 pl-2">
        <option value="">Continent</option>
        {% for code, name in continents %}
          <option value="{{ code }}" {% if request.GET.continent == code %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
      
      <select id="events_count" name="events_count" class="select select-sm select-bordered w-full sm:w-auto text-xs p-0 pl-2">
        <option value="">Events Count</option>
        <option value="1" {% if request.GET.events_count == '1' %}selected{% endif %}>At least 1</option>
        <option value="5" {% if request.GET.events_count == '5' %}selected{% endif %}>At least 5</option>
        <option value="10" {% if request.GET.events_count == '10' %}selected{% endif %}>At least 10</option>
      </select>
      
      <button type="submit" class="btn btn-sm btn-primary text-xs">Filter</button>
      <a href="{% url 'results:league_list' %}" class="btn btn-sm btn-ghost text-xs">Clear</a>
    </div>
  </form>

  <!-- League Cards -->
  {% if leagues %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for league in leagues %}
        <a href="{% url 'results:league_standings' league.slug %}" 
           class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-200">
          <div class="card-body p-0">
            <!-- Leaders Table with banner background -->
            <div class="relative">
              <div class="bg-base-300 rounded-t-2xl overflow-hidden">
                {% if league.banner %}
                <div class="absolute inset-0 z-0">
                  <img src="{{ league.banner.url }}" alt="" class="w-full h-full object-cover opacity-70">
                </div>
                {% endif %}

                <div class="bg-base-200 bg-opacity-80 p-4 rounded-t-2xl pt-4 relative z-10">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <div class="badge badge-primary">{{ league.get_league_class_display }}</div>
                      {% if league.country %}
                      <div class="badge badge-ghost">{{ league.country.name }}</div>
                      {% endif %}
                    </div>
                  </div>

                  <table class="table table-sm w-full">
                    <thead>
                      <tr>
                        <th class="w-8">#</th>
                        <th>Rider</th>
                        <th class="text-right">Points</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for standing in league.top_standings %}
                        <tr>
                          <td class="w-8">
                            {% if standing.position == 1 %}
                              <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                              </svg>
                            {% elif standing.position == 2 %}
                              <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                              </svg>
                            {% elif standing.position == 3 %}
                              <svg class="w-6 h-6 text-amber-700" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                              </svg>
                            {% else %}
                              {{ standing.position }}
                            {% endif %}
                          </td>
                          <td>{{ standing.competitor.user.get_full_name }}</td>
                          <td class="text-right">
                            <span class="badge badge-primary">{{ standing.points }}</span>
                          </td>
                        </tr>
                      {% empty %}
                        <tr>
                          <td colspan="3" class="text-center text-base-content/70">
                            No standings yet
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Regular card content with logo in top right -->
            <div class="p-4 relative">
              <!-- League logo in top right -->
              <div class="absolute top-4 right-4">
                {% if league.logo %}
                <img src="{{ league.logo.url }}" alt="{{ league.name }}" class="w-16 h-16 object-contain">
                {% else %}
                <div class="w-16 h-16 flex items-center justify-center">
                  <i class="fas fa-trophy text-3xl text-primary"></i>
                </div>
                {% endif %}
              </div>

              <h2 class="card-title pr-20">{{ league.name }}</h2>
              <p class="text-base-content/70 mt-2">{{ league.description|truncatewords:30 }}</p>
              <div class="flex justify-between items-center mt-4">
                <div class="badge badge-ghost">{{ league.events.count }} events</div>
                <div class="btn btn-primary btn-sm">View Standings</div>
              </div>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <div class="alert alert-info shadow-lg">
          <div class="flex items-start space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-8 h-8 mt-1">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="flex-1">
              <h3 class="font-bold">No Leagues Available</h3>
              <div class="text-xs">There are currently no active leagues. Check back later!</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/swiper-bundle.min.js' %}"></script>
<script src="{% static 'js/theme_gradient.js' %}"></script>
<script>
  // Initialize Swiper slider
  const swiper = new Swiper('.hero-slider', {
    loop: true,
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    autoplay: {
      delay: 5000,
    },
    effect: 'fade',
    fadeEffect: {
      crossFade: true
    }
  });
</script>
{% endblock %}
